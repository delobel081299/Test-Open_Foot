# üì¶ Description des Modules - FootballAI Analyzer

## üéØ Vue d'ensemble

Le syst√®me est compos√© de modules sp√©cialis√©s qui travaillent ensemble pour analyser les vid√©os de football. Chaque module a une responsabilit√© claire et communique via des interfaces bien d√©finies.

---

## 1. üìπ Module de Pr√©traitement Vid√©o

### Responsabilit√©
Pr√©parer les vid√©os pour l'analyse en optimisant la qualit√© et en extrayant les frames pertinentes.

### Composants

#### `video_loader.py`
```python
class VideoLoader:
    """Charge et valide les vid√©os d'entr√©e"""
    - load_video(path: str) -> Video
    - validate_format(video: Video) -> bool
    - get_metadata(video: Video) -> dict
    - check_quality(video: Video) -> QualityScore
```

#### `frame_extractor.py`
```python
class FrameExtractor:
    """Extrait les frames de la vid√©o"""
    - extract_frames(video: Video, fps: int) -> List[Frame]
    - extract_keyframes(video: Video) -> List[Frame]
    - save_frames(frames: List[Frame], output_dir: str)
    - optimize_extraction(video: Video) -> ExtractionPlan
```

#### `scene_detector.py`
```python
class SceneDetector:
    """D√©tecte les changements de sc√®ne et actions"""
    - detect_scenes(frames: List[Frame]) -> List[Scene]
    - find_action_segments(frames: List[Frame]) -> List[Segment]
    - classify_camera_angle(scene: Scene) -> CameraAngle
    - filter_relevant_scenes(scenes: List[Scene]) -> List[Scene]
```

### Entr√©es/Sorties
- **Entr√©e** : Fichier vid√©o (MP4, AVI, MOV, MKV)
- **Sortie** : Frames optimis√©es, m√©tadonn√©es, segments d'action

### Technologies
- **FFmpeg** : Manipulation vid√©o bas niveau
- **OpenCV** : Traitement d'image
- **PySceneDetect** : D√©tection de changements de sc√®ne

---

## 2. üéØ Module de D√©tection

### Responsabilit√©
D√©tecter et localiser les joueurs, le ballon et les √©l√©ments du terrain dans chaque frame.

### Composants

#### `yolo_detector.py`
```python
class YOLODetector:
    """D√©tecteur principal bas√© sur YOLOv8"""
    - load_model(model_path: str, device: str)
    - detect(frame: Frame) -> List[Detection]
    - batch_detect(frames: List[Frame]) -> List[List[Detection]]
    - adjust_confidence(threshold: float)
```

#### `player_detector.py`
```python
class PlayerDetector:
    """Sp√©cialis√© dans la d√©tection de joueurs"""
    - detect_players(frame: Frame) -> List[Player]
    - estimate_jersey_number(player: Player) -> int
    - detect_goalkeeper(players: List[Player]) -> Player
    - filter_duplicates(players: List[Player]) -> List[Player]
```

#### `ball_detector.py`
```python
class BallDetector:
    """D√©tection pr√©cise du ballon"""
    - detect_ball(frame: Frame) -> Ball
    - track_ball_trajectory(frames: List[Frame]) -> Trajectory
    - estimate_ball_possession(ball: Ball, players: List[Player]) -> Player
    - detect_ball_contact(ball: Ball, player: Player) -> bool
```

### Entr√©es/Sorties
- **Entr√©e** : Frames vid√©o
- **Sortie** : Bounding boxes, positions, classifications

### Technologies
- **YOLOv10/RT-DETR/DINO-DETR** : Mod√®les SOTA pour pr√©cision maximale
- **TensorRT** : Optimisation GPU obligatoire pour 60 FPS
- **ONNX** : Format de mod√®le portable
- **FP16/INT8** : Pr√©cision mixte pour performance

---

## 3. üèÉ Module de Tracking

### Responsabilit√©
Suivre les objets d√©tect√©s √† travers les frames pour maintenir leur identit√©.

### Composants

#### `byte_tracker.py`
```python
class ByteTracker:
    """Tracking multi-objets robuste"""
    - initialize_tracks(detections: List[Detection])
    - update_tracks(detections: List[Detection]) -> List[Track]
    - handle_occlusions(tracks: List[Track])
    - interpolate_missing(track: Track) -> Track
```

#### `team_classifier.py`
```python
class TeamClassifier:
    """Classification des √©quipes par couleur"""
    - extract_jersey_color(player: Player) -> Color
    - cluster_teams(players: List[Player]) -> Dict[Team, List[Player]]
    - classify_referee(person: Detection) -> bool
    - update_team_assignment(player: Player, history: List[Frame])
```

#### `trajectory_analyzer.py`
```python
class TrajectoryAnalyzer:
    """Analyse des trajectoires de mouvement"""
    - calculate_trajectory(track: Track) -> Trajectory
    - smooth_trajectory(trajectory: Trajectory) -> Trajectory
    - calculate_speed(trajectory: Trajectory) -> float
    - detect_sprints(trajectory: Trajectory) -> List[Sprint]
```

### Entr√©es/Sorties
- **Entr√©e** : D√©tections frame par frame
- **Sortie** : Tracks avec IDs persistants, trajectoires

### Technologies
- **ByteTrack** : Algorithme de tracking principal
- **Kalman Filter** : Pr√©diction de mouvement
- **Hungarian Algorithm** : Association d√©tection-track

---

## 4. ü¶¥ Module d'Analyse Biom√©canique

### Responsabilit√©
Analyser la posture et les mouvements corporels des joueurs.

### Composants

#### `pose_extractor.py`
```python
class PoseExtractor:
    """Extraction des keypoints corporels"""
    - extract_pose(player: Player) -> Pose3D
    - extract_batch_poses(players: List[Player]) -> List[Pose3D]
    - filter_occluded_joints(pose: Pose3D) -> Pose3D
    - interpolate_missing_joints(pose: Pose3D) -> Pose3D
```

#### `angle_calculator.py`
```python
class AngleCalculator:
    """Calcul des angles articulaires"""
    - calculate_joint_angles(pose: Pose3D) -> Dict[Joint, Angle]
    - calculate_knee_flexion(pose: Pose3D) -> float
    - calculate_hip_rotation(pose: Pose3D) -> float
    - calculate_spine_angle(pose: Pose3D) -> float
```

#### `balance_analyzer.py`
```python
class BalanceAnalyzer:
    """Analyse de l'√©quilibre et de la stabilit√©"""
    - calculate_center_of_mass(pose: Pose3D) -> Point3D
    - analyze_stability(pose_sequence: List[Pose3D]) -> StabilityScore
    - detect_imbalance(pose: Pose3D) -> bool
    - calculate_symmetry(pose: Pose3D) -> SymmetryScore
```

### Entr√©es/Sorties
- **Entr√©e** : Images de joueurs d√©tect√©s
- **Sortie** : Poses 3D, angles, scores biom√©caniques

### Technologies
- **MediaPipe Pose** : Extraction de pose principale
- **NumPy** : Calculs vectoriels
- **SciPy** : Analyses statistiques

---

## 5. ‚öΩ Module d'Analyse Technique

### Responsabilit√©
Classifier et √©valuer les gestes techniques du football.

### Composants

#### `action_classifier.py`
```python
class ActionClassifier:
    """Classification des actions football"""
    - classify_action(frames: List[Frame], player: Player) -> Action
    - get_action_confidence(action: Action) -> float
    - detect_action_start_end(frames: List[Frame]) -> Tuple[int, int]
    - classify_ball_contact_type(contact: Contact) -> ContactType
```

#### `gesture_analyzer.py`
```python
class GestureAnalyzer:
    """Analyse d√©taill√©e des gestes"""
    - analyze_pass(action: PassAction) -> PassAnalysis
    - analyze_shot(action: ShotAction) -> ShotAnalysis
    - analyze_dribble(action: DribbleAction) -> DribbleAnalysis
    - analyze_control(action: ControlAction) -> ControlAnalysis
```

#### `technique_scorer.py`
```python
class TechniqueScorer:
    """Notation de la qualit√© technique"""
    - score_technique(analysis: GestureAnalysis) -> TechniqueScore
    - identify_errors(analysis: GestureAnalysis) -> List[Error]
    - generate_feedback(score: TechniqueScore, errors: List[Error]) -> Feedback
    - compare_to_ideal(gesture: Gesture, ideal: Gesture) -> Comparison
```

### Entr√©es/Sorties
- **Entr√©e** : S√©quences vid√©o, poses, trajectoires ballon
- **Sortie** : Classifications d'actions, scores techniques, feedback

### Technologies
- **TimeSformer** : Classification d'actions vid√©o
- **Custom CNN** : Mod√®les sp√©cifiques football
- **Rule Engine** : √âvaluation bas√©e sur r√®gles expertes

---

## 6. üìä Module d'Analyse Tactique

### Responsabilit√©
Analyser les aspects collectifs et d√©cisionnels du jeu.

### Composants

#### `position_analyzer.py`
```python
class PositionAnalyzer:
    """Analyse du positionnement des joueurs"""
    - analyze_formation(team: Team, frame: Frame) -> Formation
    - calculate_team_shape(team: Team) -> Shape
    - detect_offside_line(team: Team, frame: Frame) -> Line
    - evaluate_spacing(team: Team) -> SpacingScore
```

#### `movement_patterns.py`
```python
class MovementPatternAnalyzer:
    """D√©tection de patterns de mouvement"""
    - detect_pressing(team: Team, frames: List[Frame]) -> PressingEvent
    - analyze_transition(teams: List[Team], frames: List[Frame]) -> Transition
    - detect_overlap_runs(players: List[Player]) -> List[OverlapRun]
    - analyze_defensive_line(team: Team) -> DefensiveLine
```

#### `decision_quality.py`
```python
class DecisionAnalyzer:
    """√âvaluation de la prise de d√©cision"""
    - evaluate_pass_decision(pass_event: Pass, context: GameContext) -> DecisionScore
    - find_better_options(player: Player, context: GameContext) -> List[Option]
    - analyze_shot_timing(shot: Shot, context: GameContext) -> TimingScore
    - evaluate_dribble_choice(dribble: Dribble, context: GameContext) -> ChoiceScore
```

### Entr√©es/Sorties
- **Entr√©e** : Positions joueurs, trajectoires, contexte de jeu
- **Sortie** : Analyses tactiques, scores d√©cisionnels

### Technologies
- **NetworkX** : Analyse de graphes (passes)
- **Scikit-learn** : Clustering formations
- **Custom algorithms** : M√©triques football sp√©cifiques

---

## 7. üéØ Module de Scoring

### Responsabilit√©
Agr√©ger toutes les analyses pour produire une notation finale et du feedback.

### Composants

#### `score_aggregator.py`
```python
class ScoreAggregator:
    """Agr√©gation des scores multi-crit√®res"""
    - aggregate_scores(scores: Dict[Criterion, Score]) -> FinalScore
    - apply_weights(scores: Dict[Criterion, Score], weights: Dict[Criterion, float]) -> WeightedScore
    - normalize_scores(scores: List[Score]) -> List[NormalizedScore]
    - calculate_confidence(scores: List[Score]) -> float
```

#### `feedback_generator.py`
```python
class FeedbackGenerator:
    """G√©n√©ration de feedback personnalis√©"""
    - generate_technical_feedback(analysis: TechnicalAnalysis) -> Feedback
    - generate_tactical_feedback(analysis: TacticalAnalysis) -> Feedback
    - prioritize_feedback(feedbacks: List[Feedback]) -> List[Feedback]
    - personalize_language(feedback: Feedback, player_profile: Profile) -> Feedback
```

#### `report_builder.py`
```python
class ReportBuilder:
    """Construction des rapports finaux"""
    - build_pdf_report(analysis: CompleteAnalysis) -> PDFReport
    - create_video_overlay(analysis: CompleteAnalysis, video: Video) -> AnnotatedVideo
    - generate_statistics_summary(analysis: CompleteAnalysis) -> Statistics
    - create_improvement_plan(analysis: CompleteAnalysis) -> ImprovementPlan
```

### Entr√©es/Sorties
- **Entr√©e** : Toutes les analyses des modules pr√©c√©dents
- **Sortie** : Rapport PDF, vid√©o annot√©e, plan d'am√©lioration

### Technologies
- **ReportLab** : G√©n√©ration PDF
- **Matplotlib/Plotly** : Graphiques
- **Jinja2** : Templates de rapport
- **OpenCV** : Annotation vid√©o

---

## 8. üéÆ Module d'Interface API

### Responsabilit√©
Exposer les fonctionnalit√©s via une API REST.

### Composants

#### Routes principales
```python
# upload.py
POST /api/upload          # Upload vid√©o
GET  /api/upload/status   # Statut upload

# analysis.py  
POST /api/analyze         # Lancer analyse
GET  /api/analyze/status  # Statut analyse
GET  /api/analyze/result  # R√©sultats

# reports.py
GET  /api/report/pdf      # T√©l√©charger PDF
GET  /api/report/video    # Vid√©o annot√©e
POST /api/report/share    # Partager rapport
```

### Technologies
- **FastAPI** : Framework API
- **Pydantic** : Validation donn√©es
- **SQLAlchemy** : ORM
- **Celery** : T√¢ches asynchrones (optionnel)

---

## üîó Communication Inter-Modules

### Format des messages
```python
@dataclass
class ModuleMessage:
    source: str
    target: str
    message_type: MessageType
    payload: Any
    timestamp: datetime
    correlation_id: str
```

### Pipeline de donn√©es
```
Video ‚Üí Preprocessing ‚Üí Detection ‚Üí Tracking ‚Üí 
Biomechanics ‚Üò
Technical    ‚Üí Scoring ‚Üí Report
Tactical     ‚Üó
```

### Gestion des erreurs
- Chaque module g√®re ses erreurs localement
- Propagation contr√¥l√©e vers le module appelant
- Fallback strategies pour maintenir le service
- Logging centralis√© pour debug

---

## üìà M√©triques de Performance

| Module | M√©trique Cl√© | Objectif | Mesure Actuelle |
|--------|--------------|----------|-----------------|
| Preprocessing | FPS extraction | 30 FPS | 35 FPS |
| Detection | mAP (pr√©cision) | > 85% | 89% |
| Tracking | MOTA score | > 80% | 83% |
| Biomechanics | Keypoints/sec | > 15 | 18 |
| Technical | Accuracy | > 90% | 92% |
| Tactical | Processing time | < 5s | 3.5s |
| Scoring | Report generation | < 30s | 25s | 